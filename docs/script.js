(()=>{const $=document.getElementById("image-input"),M=document.querySelector(".dropzone"),D=document.getElementById("canvas"),f=document.getElementById("spacing-input"),h=document.getElementById("randomness-input"),R=document.getElementById("gradient-checkbox"),H=document.getElementById("generate-button"),k=document.getElementById("download-button"),L=document.getElementById("generation-time"),o=D.getContext("2d");let m=20,y=10,C=!1,u,v,P=0,E=0;f.value=m;h.value=y;R.checked=C;f.onchange=()=>{m=Math.max(f.value,2),f.value=m};h.onchange=()=>{y=Math.max(h.value,0),h.value=y};R.onchange=()=>{C=R.checked};H.onclick=()=>{G(u)};k.onclick=W;M.onclick=()=>$.click();M.ondragover=t=>{t.preventDefault()};M.ondrop=t=>{t.preventDefault(),t.stopPropagation(),g=t.dataTransfer.items[0]?.getAsFile(),F()};let g;$.onchange=t=>{g=t.target.files[0],F()};function W(){if(!v)return;const t=URL.createObjectURL(v),a=document.createElement("a");a.download="convert.png",a.href=t,a.click(),a.remove()}function F(){if(!g)return;M.textContent=`${g.name} (${b(g.size)})`;const t=new FileReader;t.onload=()=>{u=new Image,u.onload=()=>{G(u)},f.max=Math.min(u.naturalWidth,u.naturalHeight),h.max=f.max,u.src=t.result},t.readAsDataURL(g)}function G(t){P=new Date().getTime(),o.canvas.width=t.naturalWidth,o.canvas.height=t.naturalHeight,o.drawImage(t,0,0),q(t.naturalWidth,t.naturalHeight)}async function q(t,a){const l=Math.ceil(t/m),s=Math.ceil(a/m),e=[],n=[];for(let d=0;d<l;++d){e[d]=[],n[d]=[];for(let r=0;r<s;++r){const i={x:Math.floor(d*m+(Math.random()-.5)*y),y:Math.floor(r*m+(Math.random()-.5)*y)};if(e[d][r]=i,C){const c=o.getImageData(i.x,i.y,1,1).data;n[d][r]=`#${x(c[0])}${x(c[1])}${x(c[2])}`}}}A(e,n,l,s)}function p(t,a,l,s,e,n){const r=o.createRadialGradient(t.x,t.y,0,t.x,t.y,50);r.addColorStop(0,s+"ff"),r.addColorStop(1,s+"00");const i=o.createRadialGradient(a.x,a.y,0,a.x,a.y,50);i.addColorStop(0,e+"ff"),i.addColorStop(1,e+"00");const c=o.createRadialGradient(l.x,l.y,0,l.x,l.y,50);c.addColorStop(0,n+"ff"),c.addColorStop(1,n+"00"),o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(a.x,a.y),o.lineTo(l.x,l.y),o.closePath(),o.fillStyle=r,o.fill(),o.fillStyle=i,o.fill(),o.fillStyle=c,o.fill()}function T(t,a,l){const s=U(t,a,l),e=o.getImageData(s.x,s.y,1,1).data,n=`#${x(e[0])}${x(e[1])}${x(e[2])}`;o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(a.x,a.y),o.lineTo(l.x,l.y),o.closePath(),o.fillStyle=n,o.fill()}function U(t,a,l){const s=Math.random(),e=Math.random(),n=Math.sqrt(s),d=(1-n)*t.x+n*(1-e)*a.x+n*e*l.x,r=(1-n)*t.y+n*(1-e)*a.y+n*e*l.y;return{x:Math.floor(d),y:Math.floor(r)}}function A(t,a,l,s){for(let e=0;e<l-1;++e)for(let n=0;n<s-1;++n){const d=t[e][n],r=t[e+1][n],i=t[e][n+1],c=t[e+1][n+1],I=a[e][n],w=a[e+1][n],B=a[e][n+1],S=a[e+1][n+1];C?Math.random()>.5?(p(d,r,i,I,w,B),p(r,i,c,w,B,S)):(p(d,r,c,I,w,S),p(d,i,c,I,B,S)):Math.random()>.5?(T(d,r,i),T(r,i,c)):(T(d,r,c),T(d,i,c))}D.toBlob(e=>{e&&(v=e,k.classList.remove("disabled"),k.textContent=`Download Result (${b(v.size)})`)}),E=new Date().getTime(),L.textContent="Generation: "+(E-P)+"ms"}function x(t){return t.toString(16).padStart(2,"0")}function b(t){return t<1024?t.toFixed(1)+" B":(t/=1024,t<1024?t.toFixed(1)+" kB":(t/=1024,t<1024?t.toFixed(1)+" MB":(t/=1024,t.toFixed(1)+" GB")))}})();
