(()=>{const D=document.getElementById("image-input"),v=document.querySelector(".dropzone"),F=document.getElementById("canvas"),f=document.getElementById("spacing-input"),x=document.getElementById("randomness-input"),R=document.getElementById("gradient-checkbox"),H=document.getElementById("generate-button"),k=document.getElementById("download-button"),L=document.getElementById("generation-time"),a=F.getContext("2d");let g=20,h=10,M=!1,G=0,E=0,u=null,T=null,m=null;f.value=g;x.value=h;R.checked=M;f.onchange=()=>{g=Math.max(f.value,2),f.value=g};x.onchange=()=>{h=Math.max(x.value,0),x.value=h};R.onchange=()=>{M=R.checked};H.onclick=()=>b(u);k.onclick=W;v.onclick=()=>D.click();v.ondragover=t=>{t.preventDefault()};v.ondrop=t=>{t.preventDefault(),t.stopPropagation(),m=t.dataTransfer.items[0]?.getAsFile(),P()};D.onchange=t=>{m=t.target.files[0],P()};function W(){if(!T)return;const t=URL.createObjectURL(T),o=document.createElement("a");o.download="convert.png",o.href=t,o.click(),o.remove()}function P(){if(!m)return;v.textContent=`${m.name} (${$(m.size)})`;const t=new FileReader;t.onload=()=>{u=new Image,u.onload=()=>{b(u)},f.max=Math.min(u.naturalWidth,u.naturalHeight),x.max=f.max,u.src=t.result},t.readAsDataURL(m)}function b(t){G=new Date().getTime(),a.canvas.width=t.naturalWidth,a.canvas.height=t.naturalHeight,a.drawImage(t,0,0),q(t.naturalWidth,t.naturalHeight)}function q(t,o){const l=Math.ceil(t/g),s=Math.ceil(o/g),e=[],n=[];for(let d=0;d<l;++d){e[d]=[],n[d]=[];for(let r=0;r<s;++r){const i={x:Math.floor(d*g+(Math.random()-.5)*h),y:Math.floor(r*g+(Math.random()-.5)*h)};if(e[d][r]=i,M){const c=a.getImageData(i.x,i.y,1,1).data;n[d][r]=`#${S(c[0])}${S(c[1])}${S(c[2])}`}}}A(e,n,l,s)}function y(t,o,l,s,e,n){const r=a.createRadialGradient(t.x,t.y,0,t.x,t.y,50);r.addColorStop(0,s+"ff"),r.addColorStop(1,s+"00");const i=a.createRadialGradient(o.x,o.y,0,o.x,o.y,50);i.addColorStop(0,e+"ff"),i.addColorStop(1,e+"00");const c=a.createRadialGradient(l.x,l.y,0,l.x,l.y,50);c.addColorStop(0,n+"ff"),c.addColorStop(1,n+"00"),a.beginPath(),a.moveTo(t.x,t.y),a.lineTo(o.x,o.y),a.lineTo(l.x,l.y),a.closePath(),a.fillStyle=r,a.fill(),a.fillStyle=i,a.fill(),a.fillStyle=c,a.fill()}function p(t,o,l){const s=U(t,o,l),e=a.getImageData(s.x,s.y,1,1).data,n="rgb("+e[0]+","+e[1]+","+e[2]+")";a.fillStyle=n,a.beginPath(),a.moveTo(t.x,t.y),a.lineTo(o.x,o.y),a.lineTo(l.x,l.y),a.fill()}function U(t,o,l){const s=Math.random(),e=Math.random(),n=Math.sqrt(s),d=(1-n)*t.x+n*(1-e)*o.x+n*e*l.x,r=(1-n)*t.y+n*(1-e)*o.y+n*e*l.y;return{x:Math.floor(d),y:Math.floor(r)}}function A(t,o,l,s){for(let e=0;e<l-1;++e)for(let n=0;n<s-1;++n){const d=t[e][n],r=t[e+1][n],i=t[e][n+1],c=t[e+1][n+1];if(M){const C=o[e][n],I=o[e+1][n],w=o[e][n+1],B=o[e+1][n+1];Math.random()>.5?(y(d,r,i,C,I,w),y(r,i,c,I,w,B)):(y(d,r,c,C,I,B),y(d,i,c,C,w,B))}else Math.random()>.5?(p(d,r,i),p(r,i,c)):(p(d,r,c),p(d,i,c))}F.toBlob(e=>{e&&(T=e,k.classList.remove("disabled"),k.textContent=`Download Result (${$(T.size)})`)}),E=new Date().getTime(),L.textContent="Generation: "+(E-G)+"ms"}function S(t){return t.toString(16).padStart(2,"0")}function $(t){return t<1024?t.toFixed(1)+" B":(t/=1024,t<1024?t.toFixed(1)+" kB":(t/=1024,t<1024?t.toFixed(1)+" MB":(t/=1024,t.toFixed(1)+" GB")))}})();
