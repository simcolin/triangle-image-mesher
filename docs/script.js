(()=>{const M=document.getElementById("image-input"),h=document.querySelector(".dropzone"),T=document.getElementById("canvas"),g=document.getElementById("spacing-input"),p=document.getElementById("randomness-input"),k=document.getElementById("generate-button"),I=document.getElementById("download-button"),e=T.getContext("2d");let u=20,y=10,x;g.value=u;p.value=y;g.onchange=()=>{u=g.value};p.onchange=()=>{y=p.value};k.onclick=R;I.onclick=E;h.onclick=()=>M.click();h.ondragover=t=>{t.preventDefault()};h.ondrop=t=>{t.preventDefault(),t.stopPropagation(),f=t.dataTransfer.items[0]?.getAsFile(),R()};let f;M.onchange=t=>{f=t.target.files[0],R()};function E(){if(!x)return;const t=URL.createObjectURL(x),n=document.createElement("a");n.download="convert.png",n.href=t,n.click(),n.remove()}function R(){if(!f)return;h.textContent=`${f.name} (${b(f.size)})`;const t=new FileReader;t.onload=()=>{const n=new Image;n.onload=()=>{F(n)},g.max=Math.min(n.naturalWidth,n.naturalHeight),p.max=g.max,n.src=t.result},t.readAsDataURL(f)}function F(t){e.canvas.width=t.naturalWidth,e.canvas.height=t.naturalHeight,e.drawImage(t,0,0),$(t.naturalWidth,t.naturalHeight)}async function $(t,n){const d=Math.ceil(t/u),s=Math.ceil(n/u),o=[],a=[];for(let r=0;r<d;++r){o[r]=[],a[r]=[];for(let l=0;l<s;++l){const c={x:Math.floor(r*u+(Math.random()-.5)*y),y:Math.floor(l*u+(Math.random()-.5)*y)};o[r][l]=c;const i=e.getImageData(c.x,c.y,1,1).data;a[r][l]=`#${w(i[0])}${w(i[1])}${w(i[2])}`}}D(o,a,d,s)}function m(t,n,d,s,o,a){const l=e.createRadialGradient(t.x,t.y,0,t.x,t.y,50);l.addColorStop(0,s+"ff"),l.addColorStop(1,s+"00");const c=e.createRadialGradient(n.x,n.y,0,n.x,n.y,50);c.addColorStop(0,o+"ff"),c.addColorStop(1,o+"00");const i=e.createRadialGradient(d.x,d.y,0,d.x,d.y,50);i.addColorStop(0,a+"ff"),i.addColorStop(1,a+"00"),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.lineTo(d.x,d.y),e.closePath(),e.fillStyle="#000",e.fill(),e.globalCompositeOperation="lighter",e.fillStyle=l,e.fill(),e.fillStyle=c,e.fill(),e.fillStyle=i,e.fill(),e.globalCompositeOperation="source-over"}function D(t,n,d,s){for(let o=0;o<d-1;++o)for(let a=0;a<s-1;++a){const r=t[o][a],l=t[o+1][a],c=t[o][a+1],i=t[o+1][a+1],v=n[o][a],C=n[o+1][a],S=n[o][a+1],B=n[o+1][a+1];Math.random()>.5?(m(r,l,c,v,C,S),m(l,c,i,C,S,B)):(m(r,l,i,v,C,B),m(r,c,i,v,S,B))}T.toBlob(o=>{o&&(x=o,I.classList.remove("disabled"),I.textContent=`Download Result (${b(x.size)})`)})}function w(t){return t.toString(16).padStart(2,"0")}function b(t){return t<1024?t.toFixed(1)+" B":(t/=1024,t<1024?t.toFixed(1)+" kB":(t/=1024,t<1024?t.toFixed(1)+" MB":(t/=1024,t.toFixed(1)+" GB")))}})();
